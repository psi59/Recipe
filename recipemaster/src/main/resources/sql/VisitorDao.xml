<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.recipe.dao.VisitorDao">
	<resultMap type="visitor" id="visitorMap">
		<id column="vno" property="visitorNo" />
		<result column="vct" property="visitorContent" />
		<result column="vimg" property="visitorImg" />
		<result column="vc_dt" property="visitorDate" />
		<result column="uno" property="visitorUserNo" />
		<result column="uno2" property="loginUserNo" />
		<result column="username" property="user.userName" />
	</resultMap>
	<!--uno - 방문자 / uno2 페이지주인  -->

	<!-- mypage 정보 가지고 오기 -->
	<select id="loadMyPageLike" resultType="int" parameterType="int">
		select ifnull(count(r2.lc_dt),0)
		from rcps r1,rcp_lik r2
		where r1.rcpno=r2.rcpno and r1.uno=${value}
	</select>

	<select id="loadMyPageScr" resultType="int" parameterType="int">
		select ifnull(count(r2.scc_dt),0)
		from rcps r1,rcp_scr r2
		where r1.rcpno=r2.rcpno and r1.uno=${value}
	</select>

	<select id="loadMyPageSum" resultType="int" parameterType="int">
		select ifnull(SUM(r1.hits),0)
		from rcps r1
		where r1.uno=${value}
	</select>

	<select id="loadMyPageAvg" resultType="int" parameterType="int">
		select ifnull(avg(r1.gpa),0)
		from rcps r1
		where r1.uno=${value}
	</select>

	<select id="selectOne" resultMap="visitorMap" parameterType="int">
		SELECT vno, vct, vc_dt, uno
		FROM vsts
		WHERE vno=#{value}
	</select>
	
	<!-- list 완료 -->
	<select id="selectList" resultMap="visitorMap" parameterType="Map">
		SELECT v.vno,u.uno,u.name username,v.uno2,v.vct,v.vc_dt
		FROM users u
		LEFT OUTER JOIN VSTS v ON u.uno=v.uno
		WHERE v.uno2=#{userNo}
		ORDER BY v.vno desc
	</select>
<!-- 여기에 mypage 주인 uno2가 들어가야함 visitorUserNo-->
	<insert id="insert" parameterType="visitor">
		INSERT INTO
		VSTS(uno,uno2,vct,vimg,vc_dt)
		VALUES
		(#{loginUserNo},#{visitorUserNo},#{visitorContent},'없음',now())
	</insert>

	<update id="update" parameterType="visitor">
		UPDATE vsts
		<set>
			vct = #{visitorContent}
		</set>
		WHERE vno =#{visitorNo}
	</update>

	<!-- delete 완료 -->
	<delete id="delete" parameterType="int">
		DELETE FROM VSTS
		WHERE
		vno=#{no}
	</delete>

</mapper>