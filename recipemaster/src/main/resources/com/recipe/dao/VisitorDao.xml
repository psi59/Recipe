<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.recipe.dao.VisitorDao">
	<resultMap type="visitor" id="visitorMap">
		<id column="vno" property="visitorNo" />
		<result column="vct" property="visitorContent" />
		<result column="vimg" property="visitorImg" />
		<result column="vc_dt" property="visitorDate" />
		<result column="uno" property="user.userNo" />
		<result column="uno2" property="visitorUserNo" />
    
	</resultMap>

<!-- mypage 정보 가지고 오기 -->
	<select id="loadMyPageLike" resultType="int" parameterType="int">
		select count(r2.lc_dt)
		from rcps r1,rcp_lik r2
		where r1.rcpno=r2.rcpno and r1.uno=${value}
		group by r1.uno
	</select>

	<select id="loadMyPageScr" resultType="int" parameterType="int">
		select count(r2.scc_dt)
		from rcps r1,rcp_scr r2
		where r1.rcpno=r2.rcpno and r1.uno=${value}
		group by r1.uno
	</select>

	<select id="loadMyPageSum" resultType="int" parameterType="int">
		select SUM(r1.hits)
		from rcps r1
		where r1.uno=${value}
		group by r1.uno
	</select>

	<select id="loadMyPageAvg" resultType="int" parameterType="int">
		select avg(r1.gpa)
		from rcps r1
		where r1.uno=${value}
		group by r1.uno
	</select>
	
	
  <!-- list 완료-->
	<select id="selectList" resultMap="visitorMap" parameterType="Map">
		SELECT vno, vct, vc_dt, uno
		FROM vsts
		ORDER BY vno desc
		LIMIT #{startIndex}, #{len}
	</select>

	<select id="selectOne" resultMap="visitorMap" parameterType="int">
		SELECT vno, vct, vc_dt, uno
		FROM vsts
		WHERE vno=#{value}
	</select>

	<insert id="insert" parameterType="visitor">
		insert into vsts(uno,uno2,vct,vimg,vc_dt)
		values ('1',#{visitorUserNo},#{visitorContent},'없음',now())
	</insert>
 
	 <update id="update" parameterType="visitor" > 
	     UPDATE vsts 
	   <set>
	     vct = #{visitorContent} 
		 </set> 
		 WHERE vno =#{visitorNo} 
	 </update>

  <!-- delete 완료 -->
  <delete id="delete" parameterType="int">
		DELETE FROM vsts
		WHERE vno=#{no}
	</delete>

</mapper>